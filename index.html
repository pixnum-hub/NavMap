<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Navigation Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}

body{background:#eaeaea}
body.dark{background:#111;color:#fff}

/* MAP */
#map{
  width:100vw;
  height:100vh;
}

/* GLASS */
.glass{
  background:rgba(255,255,255,.32);
  backdrop-filter:blur(14px);
  border-radius:18px;
}
body.dark .glass{background:rgba(0,0,0,.45)}

/* MAP LAYERS */
.layers{
  position:fixed;
  top:12px;
  left:12px;
  padding:8px;
  z-index:3000;
}
.layers div{
  padding:6px 12px;
  margin:4px 0;
  border-radius:10px;
  cursor:pointer;
  text-align:center;
}

/* DARK MODE */
.dark-btn{
  position:fixed;
  top:12px;
  right:12px;
  width:42px;
  height:42px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  cursor:pointer;
  z-index:3000;
}

/* DISTANCE (FIXED & ALWAYS VISIBLE) */
#distanceBox{
  position:fixed;
  top:68px;
  left:50%;
  transform:translateX(-50%);
  padding:8px 16px;
  font-size:14px;
  font-weight:bold;
  z-index:5000;
  pointer-events:none;
}

/* LOCATION DETAILS */
#locationBox{
  position:fixed;
  bottom:150px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:420px;
  padding:10px;
  font-size:13px;
  z-index:3000;
}

/* COMPASS */
#compass{
  position:fixed;
  right:14px;
  bottom:220px;
  width:46px;
  height:46px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  z-index:3000;
}

/* TOOLBAR */
#toolbar{
  position:fixed;
  bottom:50px;
  left:50%;
  transform:translateX(-50%);
  width:92%;
  max-width:420px;
  padding:10px;
  z-index:3000;
}

#tools{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
  margin-top:8px;
}

#tools button{
  padding:10px 14px;
  border:none;
  border-radius:20px;
  cursor:pointer;
  font-size:14px;
  background:rgba(255,255,255,.85);
}
body.dark #tools button{
  background:rgba(0,0,0,.6);
  color:#fff;
}

/* FAB */
#fab{
  position:fixed;
  right:16px;
  bottom:280px;
  width:54px;
  height:54px;
  border-radius:50%;
  background:#ff9800;
  font-size:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:4000;
}

/* FOOTER */
footer{
  position:fixed;
  bottom:0;
  width:100%;
  text-align:center;
  padding:8px 0;
  font-size:12px;
  z-index:2000;
}
</style>
</head>

<body>

<div id="map"></div>

<div class="layers glass">
  <div onclick="switchLayer('std')">Standard</div>
  <div onclick="switchLayer('ter')">Terrain</div>
  <div onclick="switchLayer('phy')">Physical</div>
</div>

<div class="dark-btn glass" onclick="toggleDark()">üåô</div>

<div id="distanceBox" class="glass">
  üìè Distance: <span id="distanceValue">0 km</span>
</div>

<div id="locationBox" class="glass">
  <b>Location Details</b><br>
  Lat: --<br>
  Lng: --<br>
  Accuracy: --<br>
  Altitude: --<br>
  Speed: --<br>
  Updated: --
</div>

<div id="compass" class="glass">üß≠</div>

<div id="toolbar" class="glass">
  <div style="text-align:center;font-weight:bold;">Tools</div>
  <div id="tools">
    <button onclick="addCenter()">‚ûï Add Marker</button>
    <button onclick="toggleUnit()">üìè KM / MI</button>
    <button onclick="removeLast()">‚ùå Remove</button>
    <button onclick="clearAll()">üßπ Clear</button>
  </div>
</div>

<div id="fab" onclick="addCenter()">‚ûï</div>

<footer class="glass">¬© Mamik Roy 2025. All Rights Reserved.</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* MAP */
const map=L.map("map").setView([20,0],2);

const layers={
  std:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}),
  ter:L.tileLayer("https://tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17}),
  phy:L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{maxZoom:19})
};
let active=layers.std; active.addTo(map);
function switchLayer(k){map.removeLayer(active); active=layers[k]; active.addTo(map);}

/* DARK MODE */
function toggleDark(){document.body.classList.toggle("dark");}

/* MARKERS & DISTANCE */
let markers=[], line=null, unit="km";

function updateDistance(){
  let total=0;
  if(markers.length>1){
    for(let i=0;i<markers.length-1;i++){
      total+=markers[i].getLatLng()
        .distanceTo(markers[i+1].getLatLng());
    }
  }

  const text = unit==="km"
    ? (total/1000).toFixed(2)+" km"
    : (total/1609.34).toFixed(2)+" mi";

  document.getElementById("distanceValue").innerText=text;

  if(line){map.removeLayer(line); line=null;}
  if(markers.length>1){
    line=L.polyline(markers.map(m=>m.getLatLng()),
      {color:"orange",weight:4}).addTo(map);
  }
}

function addMarker(latlng){
  const m=L.marker(latlng,{draggable:true}).addTo(map);
  m.on("drag",updateDistance);
  markers.push(m);
  updateDistance();
}
map.on("click",e=>addMarker(e.latlng));
function addCenter(){addMarker(map.getCenter());}
function removeLast(){
  if(markers.length){
    map.removeLayer(markers.pop());
    updateDistance();
  }
}
function clearAll(){
  markers.forEach(m=>map.removeLayer(m));
  markers=[];
  if(line){map.removeLayer(line);line=null;}
  updateDistance();
}
function toggleUnit(){unit=unit==="km"?"mi":"km"; updateDistance();}

/* USER LOCATION */
let userMarker=null;
const locBox=document.getElementById("locationBox");

if(navigator.geolocation){
  navigator.geolocation.watchPosition(p=>{
    const c=p.coords;
    const lat=c.latitude, lng=c.longitude;
    locBox.innerHTML=`<b>Location Details</b><br>
      Lat: ${lat.toFixed(6)}<br>
      Lng: ${lng.toFixed(6)}<br>
      Accuracy: ${c.accuracy||"N/A"} m<br>
      Altitude: ${c.altitude||"N/A"}<br>
      Speed: ${c.speed? (c.speed*3.6).toFixed(1)+" km/h":"N/A"}<br>
      Updated: ${new Date().toLocaleTimeString()}`;

    if(!userMarker){
      userMarker=L.marker([lat,lng]).addTo(map);
      map.setView([lat,lng],16);
    }else userMarker.setLatLng([lat,lng]);
  },()=>{}, {enableHighAccuracy:true});
}

/* COMPASS */
if(window.DeviceOrientationEvent){
  window.addEventListener("deviceorientationabsolute",e=>{
    if(e.alpha!=null){
      document.getElementById("compass")
        .style.transform=`rotate(${360-e.alpha}deg)`;
    }
  });
}
</script>

</body>
</html>
