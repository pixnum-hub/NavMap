<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Navigation Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#e8e8e8}
body.dark{background:#111;color:#fff}
#map{height:100vh;width:100vw}

.glass{
  background:rgba(255,255,255,.32);
  backdrop-filter:blur(14px);
  border-radius:18px;
}
body.dark .glass{background:rgba(0,0,0,.45)}

.top, .bottom{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:8px;
  padding:8px;
  flex-wrap:wrap;
  justify-content:center;
  z-index:1000;
}
.top{top:12px}
.bottom{bottom:80px}

.btn{
  padding:10px 14px;
  border-radius:22px;
  cursor:pointer;
  font-size:14px;
}

.layers{
  position:absolute;
  top:12px;
  left:12px;
  padding:8px;
  z-index:1000;
}
.layers div{
  padding:6px 10px;
  margin:4px 0;
  border-radius:10px;
  cursor:pointer;
  text-align:center;
}

.dark-btn{
  position:absolute;
  top:12px;
  right:12px;
  width:42px;
  height:42px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  cursor:pointer;
  z-index:1001;
}

.info{
  position:absolute;
  bottom:150px;
  left:50%;
  transform:translateX(-50%);
  padding:6px 14px;
  z-index:1000;
}

#compass{
  position:absolute;
  right:12px;
  bottom:150px;
  width:46px;
  height:46px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  z-index:1000;
}

footer{
  position:absolute;
  bottom:0;
  width:100%;
  text-align:center;
  padding:8px 0;
  font-size:12px;
}
</style>
</head>

<body>

<div id="map"></div>

<div class="layers glass">
  <div onclick="switchLayer('std')">Standard</div>
  <div onclick="switchLayer('ter')">Terrain</div>
  <div onclick="switchLayer('phy')">Physical</div>
</div>

<div class="top glass">
  <div class="btn" onclick="addCenter()">Add Marker</div>
  <div class="btn" onclick="toggleUnit()">KM / MI</div>
</div>

<div class="dark-btn glass" onclick="toggleDark()">ðŸŒ™</div>

<div id="distance" class="info glass">Distance: 0 km</div>

<div id="compass" class="glass">ðŸ§­</div>

<div class="bottom glass">
  <div class="btn" onclick="removeLast()">Remove</div>
  <div class="btn" onclick="clearAll()">Clear</div>
</div>

<footer class="glass">Â© Mamik Roy 2025. All Rights Reserved.</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* MAP */
const map=L.map("map").setView([20,0],2);
const tiles={
  std:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}),
  ter:L.tileLayer("https://tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17}),
  phy:L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{maxZoom:19})
};
let active=tiles.std;active.addTo(map);
function switchLayer(k){map.removeLayer(active);active=tiles[k];active.addTo(map);}

/* MARKERS & DISTANCE */
let markers=[],line=null,unit="km";
function addMarker(ll){
  const m=L.marker(ll,{draggable:true}).addTo(map);
  m.on("drag",calc);
  markers.push(m);calc();
}
map.on("click",e=>addMarker(e.latlng));
function addCenter(){addMarker(map.getCenter());}
function removeLast(){if(markers.length){map.removeLayer(markers.pop());calc();}}
function clearAll(){
  markers.forEach(m=>map.removeLayer(m));
  markers=[];if(line){map.removeLayer(line);line=null;}
  document.getElementById("distance").innerText="Distance: 0 "+unit;
}
function calc(){
  if(line){map.removeLayer(line);}
  if(markers.length<2){document.getElementById("distance").innerText="Distance: 0 "+unit;return;}
  const pts=markers.map(m=>m.getLatLng());
  line=L.polyline(pts,{color:"orange"}).addTo(map);
  let d=0;for(let i=0;i<pts.length-1;i++)d+=pts[i].distanceTo(pts[i+1]);
  document.getElementById("distance").innerText=
    "Distance: "+(unit==="km"?(d/1000).toFixed(2)+" km":(d/1609.34).toFixed(2)+" mi");
}
function toggleUnit(){unit=unit==="km"?"mi":"km";calc();}
function toggleDark(){document.body.classList.toggle("dark");}

/* USER GEOLOCATION */
let userMarker=null;
const userIcon=L.icon({
  iconUrl:"https://cdn-icons-png.flaticon.com/512/684/684908.png",
  iconSize:[36,36],
  iconAnchor:[18,36]
});
if(navigator.geolocation){
  navigator.geolocation.watchPosition(p=>{
    const {latitude,longitude}=p.coords;
    if(!userMarker){
      userMarker=L.marker([latitude,longitude],{icon:userIcon,zIndexOffset:1000}).addTo(map);
      map.setView([latitude,longitude],16);
    }else userMarker.setLatLng([latitude,longitude]);
  },e=>console.log(e),{enableHighAccuracy:true});
}

/* COMPASS */
if(window.DeviceOrientationEvent){
  window.addEventListener("deviceorientationabsolute",e=>{
    if(e.alpha!=null){
      document.getElementById("compass").style.transform=`rotate(${360-e.alpha}deg)`;
    }
  });
}
</script>

</body>
</html>
