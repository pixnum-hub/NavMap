<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Navigation Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}

body{background:#e8e8e8}
body.dark{background:#111;color:#fff}

#map{
  width:100vw;
  height:calc(100vh - 200px);
}

/* Glass */
.glass{
  background:rgba(255,255,255,.32);
  backdrop-filter:blur(14px);
  border-radius:18px;
}
body.dark .glass{background:rgba(0,0,0,.45)}

/* Panels */
.layers{
  position:fixed;
  top:12px;
  left:12px;
  padding:8px;
  z-index:1200;
}
.layers div{
  padding:6px 10px;
  margin:4px 0;
  border-radius:10px;
  cursor:pointer;
  text-align:center;
}

.dark-btn{
  position:fixed;
  top:12px;
  right:12px;
  width:42px;
  height:42px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  cursor:pointer;
  z-index:1200;
}

.info{
  position:fixed;
  bottom:200px;
  left:50%;
  transform:translateX(-50%);
  padding:6px 14px;
  z-index:1200;
}

/* Location Details */
#locationBox{
  position:fixed;
  bottom:110px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:420px;
  padding:10px;
  font-size:13px;
  z-index:1200;
}

/* Compass */
#compass{
  position:fixed;
  right:14px;
  bottom:260px;
  width:46px;
  height:46px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  z-index:1200;
}

/* Mobile Toolbar */
#mobileToolbar{
  position:fixed;
  bottom:50px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:420px;
  padding:10px;
  z-index:1200;
  transition:.3s;
}

#toolbarHandle{
  text-align:center;
  font-size:15px;
  cursor:pointer;
  padding:6px;
}

#toolbarContent{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
  margin-top:8px;
}

#toolbarContent button{
  padding:10px 14px;
  border:none;
  border-radius:20px;
  background:rgba(255,255,255,.85);
  cursor:pointer;
  font-size:14px;
}
body.dark #toolbarContent button{
  background:rgba(0,0,0,.6);
  color:#fff;
}

/* FAB */
#fab{
  position:fixed;
  right:16px;
  bottom:200px;
  width:54px;
  height:54px;
  border-radius:50%;
  background:#ff9800;
  color:#000;
  font-size:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:1300;
  box-shadow:0 8px 20px rgba(0,0,0,.3);
}

.hidden{
  transform:translate(-50%,120%);
  opacity:0;
  pointer-events:none;
}

/* Footer */
footer{
  position:fixed;
  bottom:0;
  width:100%;
  text-align:center;
  padding:8px 0;
  font-size:12px;
  z-index:1000;
}
</style>
</head>

<body>

<div id="map"></div>

<div class="layers glass">
  <div onclick="switchLayer('std')">Standard</div>
  <div onclick="switchLayer('ter')">Terrain</div>
  <div onclick="switchLayer('phy')">Physical</div>
</div>

<div class="dark-btn glass" onclick="toggleDark()">üåô</div>

<div id="distance" class="info glass">Distance: 0 km</div>

<div id="locationBox" class="glass">
  <b>Location Details</b><br>
  Lat: --<br>
  Lng: --<br>
  Accuracy: --<br>
  Altitude: --<br>
  Speed: --<br>
  Updated: --
</div>

<div id="compass" class="glass">üß≠</div>

<div id="mobileToolbar" class="glass">
  <div id="toolbarHandle">‚ò∞ Tools</div>
  <div id="toolbarContent">
    <button onclick="addCenter()">‚ûï Add Marker</button>
    <button onclick="toggleUnit()">üìè KM / MI</button>
    <button onclick="removeLast()">‚ùå Remove</button>
    <button onclick="clearAll()">üßπ Clear</button>
  </div>
</div>

<div id="fab">‚ûï</div>

<footer class="glass">¬© Mamik Roy 2025. All Rights Reserved.</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* MAP */
const map=L.map("map").setView([20,0],2);
const tiles={
  std:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}),
  ter:L.tileLayer("https://tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17}),
  phy:L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{maxZoom:19})
};
let active=tiles.std;active.addTo(map);
function switchLayer(k){map.removeLayer(active);active=tiles[k];active.addTo(map);}

/* MARKERS & DISTANCE */
let markers=[],line=null,unit="km";
function addMarker(ll){
  const m=L.marker(ll,{draggable:true}).addTo(map);
  m.on("drag",calc);
  markers.push(m);calc();
}
map.on("click",e=>addMarker(e.latlng));
function addCenter(){addMarker(map.getCenter());}
function removeLast(){if(markers.length){map.removeLayer(markers.pop());calc();}}
function clearAll(){
  markers.forEach(m=>map.removeLayer(m));
  markers=[];if(line){map.removeLayer(line);line=null;}
  document.getElementById("distance").innerText="Distance: 0 "+unit;
}
function calc(){
  if(line){map.removeLayer(line);}
  if(markers.length<2){
    document.getElementById("distance").innerText="Distance: 0 "+unit;
    return;
  }
  const pts=markers.map(m=>m.getLatLng());
  line=L.polyline(pts,{color:"orange"}).addTo(map);
  let d=0;for(let i=0;i<pts.length-1;i++)d+=pts[i].distanceTo(pts[i+1]);
  document.getElementById("distance").innerText=
    "Distance: "+(unit==="km"?(d/1000).toFixed(2)+" km":(d/1609.34).toFixed(2)+" mi");
}
function toggleUnit(){unit=unit==="km"?"mi":"km";calc();}
function toggleDark(){document.body.classList.toggle("dark");}

/* USER LOCATION + DETAILS */
let userMarker=null;
const locBox=document.getElementById("locationBox");
const userIcon=L.icon({
  iconUrl:"https://cdn-icons-png.flaticon.com/512/684/684908.png",
  iconSize:[36,36],
  iconAnchor:[18,36]
});

if(navigator.geolocation){
  navigator.geolocation.watchPosition(p=>{
    const c=p.coords;
    const lat=c.latitude.toFixed(6);
    const lng=c.longitude.toFixed(6);
    const acc=c.accuracy?c.accuracy+" m":"N/A";
    const alt=c.altitude?c.altitude.toFixed(1)+" m":"N/A";
    const spd=c.speed?(c.speed*3.6).toFixed(1)+" km/h":"N/A";
    const time=new Date().toLocaleTimeString();

    locBox.innerHTML=`<b>Location Details</b><br>
      Lat: ${lat}<br>
      Lng: ${lng}<br>
      Accuracy: ${acc}<br>
      Altitude: ${alt}<br>
      Speed: ${spd}<br>
      Updated: ${time}`;

    if(!userMarker){
      userMarker=L.marker([lat,lng],{icon:userIcon,zIndexOffset:1000}).addTo(map);
      map.setView([lat,lng],16);
    }else userMarker.setLatLng([lat,lng]);
  },()=>{}, {enableHighAccuracy:true});
}

/* COMPASS */
if(window.DeviceOrientationEvent){
  window.addEventListener("deviceorientationabsolute",e=>{
    if(e.alpha!=null){
      document.getElementById("compass").style.transform=`rotate(${360-e.alpha}deg)`;
    }
  });
}

/* TOOLBAR */
const toolbar=document.getElementById("mobileToolbar");
const handle=document.getElementById("toolbarHandle");
let visible=true;

handle.onclick=()=>{
  visible=!visible;
  toolbar.classList.toggle("hidden",!visible);
};

map.on("click",()=>{
  if(visible){
    toolbar.classList.add("hidden");
    visible=false;
  }
});

document.getElementById("fab").onclick=()=>{
  toolbar.classList.remove("hidden");
  visible=true;
  addCenter();
};
</script>

</body>
</html>
